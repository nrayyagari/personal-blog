<style>
/* Style for code blocks */
div.highlight, pre {
    position: relative;
}

.copy-code-button {
    position: absolute;
    top: 5px;
    right: 5px;
    min-width: 100px;
    background-color: rgba(255, 255, 255, 0.15);
    padding: 8px 16px;
    color: #ffffff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    font-family: inherit;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.2s ease;
    opacity: 0;
}

div.highlight:hover .copy-code-button, pre:hover .copy-code-button {
    opacity: 1;
}

.copy-code-button:hover {
    background-color: rgba(255, 255, 255, 0.25);
}

.copy-code-button.copied {
    background-color: #28a745;
}

.copy-icon {
    display: inline-block;
    width: 16px;
    height: 16px;
}

.copy-icon svg {
    fill: currentColor;
    width: 100%;
    height: 100%;
}

/* Dark mode specific styles */
@media (prefers-color-scheme: dark) {
    .copy-code-button {
        background-color: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.2);
    }
    
    .copy-code-button:hover {
        background-color: rgba(255, 255, 255, 0.2);
        border-color: rgba(255, 255, 255, 0.3);
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // Create the copy button HTML
    function createCopyButton() {
        const button = document.createElement('button');
        button.className = 'copy-code-button';
        
        const iconSpan = document.createElement('span');
        iconSpan.className = 'copy-icon';
        iconSpan.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>';
        
        const text = document.createElement('span');
        text.textContent = 'Copy';
        
        button.appendChild(iconSpan);
        button.appendChild(text);
        
        return button;
    }

    // Add copy button to all code blocks
    document.querySelectorAll('div.highlight, pre').forEach(codeBlock => {
        // Skip if it already has a copy button
        if (codeBlock.querySelector('.copy-code-button')) return;
        
        const button = createCopyButton();
        codeBlock.appendChild(button);
        
        button.addEventListener('click', async () => {
            // Get the code content
            const code = codeBlock.querySelector('code') || codeBlock;
            const text = code.textContent;
            
            try {
                await navigator.clipboard.writeText(text);
                const textSpan = button.querySelector('span:last-child');
                button.classList.add('copied');
                textSpan.textContent = 'Copied!';
                
                setTimeout(() => {
                    button.classList.remove('copied');
                    textSpan.textContent = 'Copy';
                }, 2000);
            } catch (err) {
                console.error('Failed to copy:', err);
                const textSpan = button.querySelector('span:last-child');
                textSpan.textContent = 'Error!';
            }
        });
    });
});
</script>
