<style>
.highlight {
    position: relative !important;
}

.copy-code-button {
    position: absolute;
    top: 5px;
    right: 5px;
    min-width: 100px;
    background-color: rgba(255, 255, 255, 0.15);
    padding: 8px 16px;
    color: #ffffff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    font-family: inherit;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.2s ease;
    z-index: 20;
}

.copy-code-button:hover {
    background-color: rgba(255, 255, 255, 0.25);
}

.copy-code-button.copied {
    background-color: #28a745;
}

.copy-icon {
    display: inline-block;
    width: 16px;
    height: 16px;
}

.copy-icon svg {
    fill: currentColor;
    width: 100%;
    height: 100%;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
    function addCopyButton(element) {
        // Create button
        const button = document.createElement('button');
        button.className = 'copy-code-button';
        
        // Add icon
        const iconSpan = document.createElement('span');
        iconSpan.className = 'copy-icon';
        iconSpan.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>';
        button.appendChild(iconSpan);
        
        // Add text
        const text = document.createElement('span');
        text.textContent = 'Copy';
        button.appendChild(text);
        
        // Add click handler
        button.addEventListener('click', async () => {
            // Get code content
            const codeElement = element.querySelector('code') || element;
            const textContent = codeElement.textContent;
            
            try {
                await navigator.clipboard.writeText(textContent);
                text.textContent = 'Copied!';
                button.classList.add('copied');
                
                setTimeout(() => {
                    text.textContent = 'Copy';
                    button.classList.remove('copied');
                }, 2000);
            } catch (err) {
                console.error('Failed to copy:', err);
                text.textContent = 'Error!';
            }
        });
        
        // Add button to element
        element.appendChild(button);
    }
    
    // Add copy buttons to all code blocks
    function addCopyButtonsToCodeBlocks() {
        // Target both direct code blocks and highlighted code blocks
        const codeBlocks = document.querySelectorAll('.highlight, div[class*="language-"], pre:not(.highlight pre)');
        
        codeBlocks.forEach(block => {
            if (!block.querySelector('.copy-code-button')) {
                addCopyButton(block);
            }
        });
    }
    
    // Initial addition of copy buttons
    addCopyButtonsToCodeBlocks();
    
    // Add buttons to any new code blocks that might be added dynamically
    const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            if (mutation.addedNodes.length) {
                addCopyButtonsToCodeBlocks();
            }
        });
    });
    
    observer.observe(document.body, {
        childList: true,
        subtree: true
    });
});
</script>
